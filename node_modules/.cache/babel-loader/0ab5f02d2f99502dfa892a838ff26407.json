{"ast":null,"code":"import _regeneratorRuntime from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{useState,useEffect}from'react';import axios from'axios';import{NotificationContainer,NotificationManager}from'react-notifications';import'react-notifications/lib/notifications.css';import{SessionContext}from\"../../Context/Session\";import\"croppie/croppie.css\";// import { Button, Grid } from \"@material-ui/core\"\nimport Croppie from\"croppie\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ImageUpload=/*#__PURE__*/function(_React$Component){_inherits(ImageUpload,_React$Component);var _super=_createSuper(ImageUpload);function ImageUpload(props){var _this;_classCallCheck(this,ImageUpload);_this=_super.call(this,props);// const userInfo = localStorage.getItem('user-info')\n// const user = JSON.parse(userInfo)\n_this.componentDidMount=function(){var c=new Croppie(document.getElementById('image-helper'),{viewport:{width:400,height:400,type:'square'},boundary:{width:410,height:410}});_this.setState({croppie:c});};_this.handleImage=function(event){var image=URL.createObjectURL(event.target.files[0]);_this.setState({image:image});var c=_this.state.croppie;c.bind({url:image});_this.setState({croppie:c});};_this.onConfirm=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(link,file){var userInfo,formData,response,message,_i,_Object$entries,_Object$entries$_i,key,value;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:userInfo=JSON.parse(localStorage.getItem('user-info'));axios.interceptors.request.use(function(config){config.headers.authorization=\"Bearer \".concat(userInfo.user.token);return config;},function(error){return Promise.reject(error);});formData=new FormData();formData.append(\"file\",file);formData.append(\"id\",userInfo.user.user_id);_context.next=7;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/managers/manager/\").concat(link),formData);case 7:response=_context.sent;if(response.data.status==='success'){NotificationManager.success('Məlumatlar dəyişdirildi.','Success',5000);if(response.data.user){userInfo['user']['user_info']=response.data.user;localStorage.setItem('user-info',JSON.stringify(userInfo));_this.context.setSession(response.data.status,userInfo);_this.props.setImage(response.data.image);}}if(response.data.status==='error'){message=response.data.message;for(_i=0,_Object$entries=Object.entries(message);_i<_Object$entries.length;_i++){_Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];NotificationManager.error(value,'Error',5000);}}case 10:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();_this.handleSubmit=function(event){event.preventDefault();if(_this.state.croppie!==null){_this.state.croppie.result({type:'blob',size:{width:500,height:500}}).then(function(blob){_this.onConfirm('add_image',blob);});}};_this.onCancel=function(){var c=_this.state.croppie;c.bind({url:''});_this.setState({croppie:c});_this.setState({image:''});};_this.state={croppie:null,image:'',delete:false};return _this;}_createClass(ImageUpload,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NotificationContainer,{}),/*#__PURE__*/_jsx(\"div\",{class:\"modal fade bd-example-modal-lg\",id:\"imageUpload\",tabindex:\"-1\",role:\"dialog\",\"aria-labelledby\":\"imageUploadLabel\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{class:\"modal-dialog modal-lg\",role:\"document\",children:/*#__PURE__*/_jsx(\"form\",{onSubmit:this.handleSubmit,children:/*#__PURE__*/_jsxs(\"div\",{class:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h5\",{class:\"modal-title\",id:\"imageUploadLabel\",children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"close\",\"data-dismiss\":\"modal\",\"aria-label\":\"Close\",children:/*#__PURE__*/_jsx(\"span\",{\"aria-hidden\":\"true\",children:\"\\xD7\"})})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"modal-body\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"image-helper\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:this.handleImage,id:\"cover_image\"})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"reset\",class:\"btn btn-secondary\",\"data-dismiss\":\"modal\",onClick:this.onCancel,children:\"Close\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",class:\"btn btn-primary\",children:\"Save changes\"})]})]})})})})]});}}]);return ImageUpload;}(React.Component);ImageUpload.contextType=SessionContext;export default ImageUpload;","map":{"version":3,"sources":["C:/wamp64/www/INOVA/newsystem/manager/src/Components/Profile/ImageUpload.js"],"names":["React","useState","useEffect","axios","NotificationContainer","NotificationManager","SessionContext","Croppie","ImageUpload","props","componentDidMount","c","document","getElementById","viewport","width","height","type","boundary","setState","croppie","handleImage","event","image","URL","createObjectURL","target","files","state","bind","url","onConfirm","link","file","userInfo","JSON","parse","localStorage","getItem","interceptors","request","use","config","headers","authorization","user","token","error","Promise","reject","formData","FormData","append","user_id","post","process","env","REACT_APP_API_URL","response","data","status","success","setItem","stringify","context","setSession","setImage","message","Object","entries","key","value","handleSubmit","preventDefault","result","size","then","blob","onCancel","delete","Component","contextType"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { NotificationContainer, NotificationManager } from 'react-notifications';\r\nimport 'react-notifications/lib/notifications.css';\r\nimport { SessionContext } from \"../../Context/Session\";\r\n\r\nimport \"croppie/croppie.css\";\r\n// import { Button, Grid } from \"@material-ui/core\"\r\nimport Croppie from \"croppie\";\r\n\r\n\r\n\r\n\r\nclass ImageUpload extends React.Component {\r\n    static contextType = SessionContext;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        // const userInfo = localStorage.getItem('user-info')\r\n        // const user = JSON.parse(userInfo)\r\n\r\n        \r\n\r\n\r\n        this.state = {\r\n            croppie: null,\r\n            image: '',\r\n            delete: false,\r\n        }\r\n    }\r\n\r\n    componentDidMount = () => {\r\n\r\n        var c = new Croppie(document.getElementById('image-helper'), {\r\n            viewport: {\r\n                width: 400,\r\n                height: 400,\r\n                type: 'square'\r\n            },\r\n            boundary: {\r\n                width: 410,\r\n                height: 410,\r\n            }\r\n        });\r\n\r\n        this.setState({ croppie: c })\r\n    }\r\n    handleImage = (event) => {\r\n        let image = URL.createObjectURL(event.target.files[0])\r\n        this.setState({ image })\r\n        let c = this.state.croppie;\r\n        c.bind({\r\n            url: image,\r\n        });\r\n        this.setState({ croppie: c })\r\n    }\r\n    onConfirm = async (link, file) => {\r\n\r\n        const userInfo = JSON.parse(localStorage.getItem('user-info'))\r\n        axios.interceptors.request.use(\r\n            config => {\r\n                config.headers.authorization = `Bearer ${userInfo.user.token}`;\r\n                return config;\r\n            },\r\n            error => {\r\n                return Promise.reject(error)\r\n            }\r\n        )\r\n\r\n        let formData = new FormData();\r\n        formData.append(\"file\", file)\r\n\r\n        formData.append(\"id\", userInfo.user.user_id)\r\n\r\n        let response = await axios.post(`${process.env.REACT_APP_API_URL}/managers/manager/${link}`, formData)\r\n\r\n\r\n        if (response.data.status === 'success') {\r\n            NotificationManager.success('Məlumatlar dəyişdirildi.', 'Success', 5000);\r\n            if (response.data.user) {\r\n                userInfo['user']['user_info'] = response.data.user;\r\n                localStorage.setItem('user-info', JSON.stringify(userInfo))\r\n                this.context.setSession(response.data.status, userInfo)\r\n                this.props.setImage(response.data.image)\r\n            }\r\n        }\r\n        if (response.data.status === 'error') {\r\n            let message = response.data.message;\r\n            for (const [key, value] of Object.entries(message)) {\r\n                NotificationManager.error(value, 'Error', 5000);\r\n            }\r\n\r\n        }\r\n    }\r\n    handleSubmit = (event) => {\r\n        event.preventDefault()\r\n        if (this.state.croppie !== null) {\r\n            this.state.croppie.result({\r\n                type: 'blob',\r\n                size: {\r\n                    width: 500,\r\n                    height: 500\r\n                }\r\n            }).then((blob) => {\r\n                this.onConfirm('add_image', blob)\r\n            }\r\n            )\r\n        }\r\n    }\r\n    onCancel = () => {\r\n        let c = this.state.croppie;\r\n        c.bind({\r\n            url: '',\r\n        });\r\n        this.setState({ croppie: c })\r\n        this.setState({ image: '' })\r\n    }\r\n    render() {\r\n        return (\r\n            <>\r\n                <NotificationContainer />\r\n                <div class=\"modal fade bd-example-modal-lg\" id=\"imageUpload\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"imageUploadLabel\" aria-hidden=\"true\">\r\n                    <div class=\"modal-dialog modal-lg\" role=\"document\">\r\n                        <form onSubmit={this.handleSubmit}>\r\n                            <div class=\"modal-content\">\r\n                                <div class=\"modal-header\">\r\n                                    <h5 class=\"modal-title\" id=\"imageUploadLabel\">Edit</h5>\r\n                                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                                        <span aria-hidden=\"true\">&times;</span>\r\n                                    </button>\r\n                                </div>\r\n                                <div class=\"modal-body\">\r\n                                    <div id=\"image-helper\"></div>\r\n                                    <input type=\"file\" accept=\"image/*\" onChange={this.handleImage} id=\"cover_image\"></input>\r\n                                </div>\r\n                                <div class=\"modal-footer\">\r\n                                    <button type=\"reset\" class=\"btn btn-secondary\" data-dismiss=\"modal\" onClick={this.onCancel}>Close</button>\r\n                                    <button type=\"submit\" class=\"btn btn-primary\">Save changes</button>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </>\r\n\r\n        );\r\n    }\r\n}\r\n\r\nexport default ImageUpload;"]},"metadata":{},"sourceType":"module"}