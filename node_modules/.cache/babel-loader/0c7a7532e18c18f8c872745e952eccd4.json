{"ast":null,"code":"\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj;\n};\n\nvar React = require(\"react\");\n\nvar ReactDOM = require(\"react-dom\");\n\nvar Transform = require(\"./Transform\");\n\nvar StyleRelated = require(\"./styleStuff\"); ///////////\n\n\nvar TransformOrigin = function TransformOrigin(el) {\n  if (!el || !el.style[StyleRelated.CSS_TRANS_ORG]) {\n    this.x = 0;\n    this.y = 0;\n    return;\n  }\n\n  var css = el.style[StyleRelated.CSS_TRANS_ORG].split(' ');\n  this.x = parseFloat(css[0]);\n  this.y = parseFloat(css[1]);\n};\n\nTransformOrigin.prototype.toString = function () {\n  return this.x + 'px ' + this.y + 'px';\n}; //////////\n\n\nvar Croppie = React.createClass({\n  displayName: \"Croppie\",\n  //////////\n  isDragging: false,\n  originalX: null,\n  originalY: null,\n  originalDistance: null,\n  vpRect: null,\n  transform: null,\n  _currentZoom: 1,\n  data: {},\n  //TODO\n  //////////////\n  PropTypes: {\n    viewport: React.PropTypes.object,\n    //TODO objectOf\n    boundary: React.PropTypes.object,\n    //TODO objectOf\n    orientationControls: React.PropTypes.object,\n    //TODO objectOf\n    customClass: React.PropTypes.string,\n    showZoomer: React.PropTypes.bool,\n    enableZoom: React.PropTypes.bool,\n    mouseWheelZoom: React.PropTypes.bool,\n    enableExif: React.PropTypes.bool,\n    enforceBoundary: React.PropTypes.bool,\n    enableOrientation: React.PropTypes.bool,\n    update: React.PropTypes.func,\n    url: React.PropTypes.string\n  },\n  getInitialState: function getInitialState() {\n    return {};\n  },\n  componentDidMount: function componentDidMount() {\n    this._bind(this.props.url);\n  },\n  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {\n    if (nextProps.url !== this.props.url) this._bind(nextProps.url);\n  },\n  getDefaultProps: function getDefaultProps() {\n    return {\n      viewport: {\n        width: 100,\n        height: 100,\n        type: 'circle'\n      },\n      boundary: {\n        width: 300,\n        height: 300\n      },\n      orientationControls: {\n        enabled: true,\n        leftClass: '',\n        rightClass: ''\n      },\n      customClass: '',\n      showZoomer: true,\n      enableZoom: true,\n      mouseWheelZoom: true,\n      enableExif: false,\n      enforceBoundary: true,\n      enableOrientation: false,\n      update: function update() {}\n    };\n  },\n  render: function render() {\n    var self = this,\n        contClass = 'croppie-container',\n        customViewportClass = this.props.viewport.type ? 'cr-vp-' + this.props.viewport.type : \" \",\n        preview;\n    if (self.props.enableOrientation) preview = React.createElement(\"canvas\", {\n      className: \"cr-image\",\n      ref: \"preview\",\n      style: this.state.previewStyle || {}\n    }, \" \");else preview = React.createElement(\"img\", {\n      src: \"\",\n      className: \"cr-image\",\n      ref: \"preview\",\n      style: this.state.previewStyle || {}\n    });\n    var onWheelFunc = this.props.enableZoom ? this.onWheel : function () {};\n    return React.createElement(\"div\", {\n      className: contClass\n    }, React.createElement(\"div\", {\n      className: \"cr-boundary\",\n      ref: \"boundary\",\n      style: {\n        width: this.props.boundary.width,\n        height: this.props.boundary.height\n      },\n      onWheel: onWheelFunc\n    }, preview, React.createElement(\"div\", {\n      tabIndex: \"0\",\n      onKeyDown: this.keyDown,\n      ref: \"viewport\",\n      className: \"cr-viewport \" + customViewportClass,\n      style: {\n        width: this.props.viewport.width,\n        height: this.props.viewport.height\n      }\n    }), React.createElement(\"div\", {\n      className: \"cr-overlay\",\n      onTouchStart: this.mouseDown,\n      onMouseDown: this.mouseDown,\n      style: this.state.overlayStyle\n    })), this.props.enableZoom && React.createElement(\"div\", {\n      className: \"cr-slider-wrap\"\n    }, React.createElement(\"input\", {\n      type: \"range\",\n      className: \"cr-slider\",\n      step: \"0.0001\",\n      style: {\n        display: this.props.showZoomer ? \"\" : \"none\"\n      },\n      onChange: this.changeZoom,\n      ref: \"zoomer\"\n    })));\n  },\n  onWheel: function onWheel(ev) {\n    var self = this;\n    var delta, targetZoom;\n\n    if (ev.wheelDelta) {\n      delta = ev.wheelDelta / 1200; //wheelDelta min: -120 max: 120 // max x 10 x 2\n    } else if (ev.deltaY) {\n      delta = ev.deltaY / 1060; //deltaY min: -53 max: 53 // max x 10 x 2\n    } else if (ev.detail) {\n      delta = ev.detail / -60; //delta min: -3 max: 3 // max x 10 x 2\n    } else {\n      delta = 0;\n    }\n\n    targetZoom = self._currentZoom + delta;\n    ev.preventDefault();\n\n    this._setZoomerVal(targetZoom);\n\n    this.changeZoom();\n  },\n  mouseDown: function mouseDown(ev) {\n    ev.preventDefault();\n    if (this.isDragging) return;\n    this.isDragging = true;\n    this.originalX = ev.pageX;\n    this.originalY = ev.pageY;\n\n    if (ev.touches) {\n      var touches = ev.touches[0];\n      this.originalX = touches.pageX;\n      this.originalY = touches.pageY;\n    }\n\n    this.transform = Transform.parse(this.refs.preview);\n    window.addEventListener('mousemove', this.mouseMove);\n    window.addEventListener('touchmove', this.mouseMove);\n    window.addEventListener('mouseup', this.mouseUp);\n    window.addEventListener('touchend', this.mouseUp);\n    document.body.style[StyleRelated.CSS_USERSELECT] = 'none';\n    this.vpRect = this.refs.viewport.getBoundingClientRect();\n  },\n  keyDown: function keyDown(ev) {\n    var self = this;\n    var LEFT_ARROW = 37,\n        UP_ARROW = 38,\n        RIGHT_ARROW = 39,\n        DOWN_ARROW = 40;\n\n    if (ev.shiftKey && (ev.keyCode == UP_ARROW || ev.keyCode == DOWN_ARROW)) {\n      var zoom = 0.0;\n\n      if (ev.keyCode == UP_ARROW) {\n        zoom = parseFloat(self.refs.zoomer.value, 10) + parseFloat(self.refs.zoomer.step, 10);\n      } else {\n        zoom = parseFloat(self.refs.zoomer.value, 10) - parseFloat(self.refs.zoomer.step, 10);\n      } // self.setZoom(zoom);\n\n\n      self._setZoomerVal(zoom);\n    } else if (ev.keyCode >= 37 && ev.keyCode <= 40) {\n      ev.preventDefault();\n      var movement = parseKeyDown(ev.keyCode);\n      self.transform = Transform.parse(self.refs.preview);\n      document.body.style[StyleRelated.CSS_USERSELECT] = 'none';\n      self.vpRect = self.refs.viewport.getBoundingClientRect();\n      self.keyMove(movement);\n    }\n\n    function parseKeyDown(key) {\n      switch (key) {\n        case LEFT_ARROW:\n          return [1, 0];\n\n        case UP_ARROW:\n          return [0, 1];\n\n        case RIGHT_ARROW:\n          return [-1, 0];\n\n        case DOWN_ARROW:\n          return [0, -1];\n      }\n    }\n  },\n  keyMove: function keyMove(movement) {\n    var deltaX = movement[0],\n        deltaY = movement[1],\n        newCss = {};\n    this.assignTransformCoordinates(deltaX, deltaY);\n    newCss[StyleRelated.CSS_TRANSFORM] = this.transform.toString(); // css(self.elements.preview, newCss);\n\n    this.setState({\n      previewStyle: newCss\n    });\n\n    this._updateOverlay();\n\n    document.body.style[StyleRelated.CSS_USERSELECT] = '';\n\n    this._updateCenterPoint(); // _triggerUpdate.call(self);TODO\n\n\n    this.originalDistance = 0;\n  },\n  mouseMove: function mouseMove(ev) {\n    ev.preventDefault();\n    var pageX = ev.pageX,\n        pageY = ev.pageY;\n\n    if (ev.touches) {\n      var touches = ev.touches[0];\n      pageX = touches.pageX;\n      pageY = touches.pageY;\n    }\n\n    var deltaX = pageX - this.originalX,\n        deltaY = pageY - this.originalY,\n        newCss = {};\n\n    if (ev.type == 'touchmove') {\n      if (ev.touches.length > 1) {\n        var touch1 = ev.touches[0];\n        var touch2 = ev.touches[1];\n        var dist = Math.sqrt((touch1.pageX - touch2.pageX) * (touch1.pageX - touch2.pageX) + (touch1.pageY - touch2.pageY) * (touch1.pageY - touch2.pageY));\n\n        if (!this.originalDistance) {\n          this.originalDistance = dist / self._currentZoom;\n        }\n\n        var scale = dist / this.originalDistance;\n\n        this._setZoomerVal.call(self, scale); //dispatchChange(self.elements.zoomer);TODO\n\n\n        return;\n      }\n    }\n\n    this.assignTransformCoordinates(deltaX, deltaY);\n    newCss[StyleRelated.CSS_TRANSFORM] = this.transform.toString(); //css(self.elements.preview, newCss);\n\n    this.setState({\n      previewStyle: cssExtend(newCss, this.state.previewStyle)\n    });\n    setTimeout(this._updateOverlay, 0);\n    this.originalY = pageY;\n    this.originalX = pageX;\n  },\n  changeZoom: function changeZoom() {\n    var self = this;\n\n    this._onZoom({\n      value: parseFloat(this.refs.zoomer.value),\n      origin: new TransformOrigin(self.refs.preview),\n      viewportRect: self.refs.viewport.getBoundingClientRect(),\n      transform: Transform.parse(self.refs.preview)\n    });\n  },\n  mouseUp: function mouseUp() {\n    this.isDragging = false;\n    window.removeEventListener('mousemove', this.mouseMove);\n    window.removeEventListener('touchmove', this.mouseMove);\n    window.removeEventListener('mouseup', this.mouseUp);\n    window.removeEventListener('touchend', this.mouseUp);\n    document.body.style[StyleRelated.CSS_USERSELECT] = '';\n\n    this._updateCenterPoint(); // this._triggerUpdate.call(self);TODO\n\n\n    this.originalDistance = 0;\n  },\n  _updateOverlay: function _updateOverlay() {\n    var boundRect = this.refs.boundary.getBoundingClientRect(),\n        imgData = this.refs.preview.getBoundingClientRect();\n    this.setState({\n      overlayStyle: {\n        width: imgData.width + 'px',\n        height: imgData.height + 'px',\n        top: imgData.top - boundRect.top + 'px',\n        left: imgData.left - boundRect.left + 'px'\n      }\n    });\n  },\n  _setZoomerVal: function _setZoomerVal(v) {\n    //TODO\n    if (this.props.enableZoom) {\n      var z = ReactDOM.findDOMNode(this.refs.zoomer),\n          val = this.fix(v, 4);\n      z.value = Math.max(z.min, Math.min(z.max, val));\n    }\n  },\n  _onZoom: function _onZoom(ui) {\n    var self = this,\n        transform = ui ? ui.transform : Transform.parse(ReactDOM.findDOMNode(this.refs.preview)),\n        vpRect = ui ? ui.viewportRect : self.refs.elements.viewport.getBoundingClientRect(),\n        //TODO does this need this.vpRect\n    origin = ui ? ui.origin : new TransformOrigin(ReactDOM.findDOMNode(this.refs.preview)),\n        transCss = {};\n\n    function applyCss() {\n      var transCss = {};\n      transCss[StyleRelated.CSS_TRANSFORM] = transform.toString();\n      transCss[StyleRelated.CSS_TRANS_ORG] = origin.toString();\n      self.setState({\n        previewStyle: transCss\n      });\n    }\n\n    self._currentZoom = ui ? ui.value : self._currentZoom;\n    transform.scale = self._currentZoom;\n    applyCss();\n\n    if (this.props.enforceBoundary) {\n      var boundaries = this._getVirtualBoundaries(vpRect),\n          transBoundaries = boundaries.translate,\n          oBoundaries = boundaries.origin;\n\n      if (transform.x >= transBoundaries.maxX) {\n        origin.x = oBoundaries.minX;\n        transform.x = transBoundaries.maxX;\n      }\n\n      if (transform.x <= transBoundaries.minX) {\n        origin.x = oBoundaries.maxX;\n        transform.x = transBoundaries.minX;\n      }\n\n      if (transform.y >= transBoundaries.maxY) {\n        origin.y = oBoundaries.minY;\n        transform.y = transBoundaries.maxY;\n      }\n\n      if (transform.y <= transBoundaries.minY) {\n        origin.y = oBoundaries.maxY;\n        transform.y = transBoundaries.minY;\n      }\n    }\n\n    applyCss();\n    setTimeout(this._updateOverlay, 0); //_triggerUpdate.call(self); TODO\n  },\n  _getVirtualBoundaries: function _getVirtualBoundaries(viewport) {\n    //TODO\n    var self = this,\n        scale = self._currentZoom,\n        vpWidth = viewport.width,\n        vpHeight = viewport.height,\n        centerFromBoundaryX = self.props.boundary.width / 2,\n        centerFromBoundaryY = self.props.boundary.height / 2,\n        imgRect = self.refs.preview.getBoundingClientRect(),\n        curImgWidth = imgRect.width,\n        curImgHeight = imgRect.height,\n        halfWidth = vpWidth / 2,\n        halfHeight = vpHeight / 2;\n    var maxX = (halfWidth / scale - centerFromBoundaryX) * -1;\n    var minX = maxX - (curImgWidth * (1 / scale) - vpWidth * (1 / scale));\n    var maxY = (halfHeight / scale - centerFromBoundaryY) * -1;\n    var minY = maxY - (curImgHeight * (1 / scale) - vpHeight * (1 / scale));\n    var originMinX = 1 / scale * halfWidth;\n    var originMaxX = curImgWidth * (1 / scale) - originMinX;\n    var originMinY = 1 / scale * halfHeight;\n    var originMaxY = curImgHeight * (1 / scale) - originMinY;\n    return {\n      translate: {\n        maxX: maxX,\n        minX: minX,\n        maxY: maxY,\n        minY: minY\n      },\n      origin: {\n        maxX: originMaxX,\n        minX: originMinX,\n        maxY: originMaxY,\n        minY: originMinY\n      }\n    };\n  },\n  fix: function fix(v, decimalPoints) {\n    return parseFloat(v).toFixed(decimalPoints || 0);\n  },\n  _bind: function _bind(options) {\n    var self = this,\n        url,\n        points = [],\n        zoom = null;\n\n    if (typeof options === 'string') {\n      url = options;\n      options = {};\n    } else if (Array.isArray(options)) {\n      points = options.slice();\n    } else if (typeof options == 'undefined' && self.data.url) {\n      //refreshing TODO\n      this._updatePropertiesFromImage.call(self); // _triggerUpdate.call(self);TODO\n\n\n      return null;\n    } else {\n      url = options.url;\n      points = options.points || [];\n      zoom = typeof options.zoom === 'undefined' ? null : options.zoom;\n    }\n\n    self.data.bound = false;\n    self.data.url = url || self.data.url;\n    self.data.points = (points || self.data.points).map(function (p) {\n      return parseFloat(p);\n    });\n    self.data.boundZoom = zoom;\n    var prom = this.loadImage(url, self.refs.preview);\n    prom.then(function () {\n      self._updatePropertiesFromImage.call(self); // _triggerUpdate.call(self);TODO\n\n    });\n    return prom;\n  },\n  loadImage: function loadImage(src, imageEl) {\n    var self = this;\n    var img = imageEl || new Image(),\n        prom;\n\n    if (img.src === src) {\n      // If image source hasn't changed, return a promise that resolves immediately\n      prom = new Promise(function (resolve, reject) {\n        resolve(img);\n      });\n    } else {\n      prom = new Promise(function (resolve, reject) {\n        if (self.props.enableOrientation && src.substring(0, 4).toLowerCase() === 'http') {\n          img.setAttribute('crossOrigin', 'anonymous');\n        }\n\n        img.onload = function () {\n          setTimeout(function () {\n            resolve(img);\n          }, 1);\n        };\n      });\n      img.src = src;\n    }\n\n    return prom;\n  },\n  _updatePropertiesFromImage: function _updatePropertiesFromImage() {\n    var self = this,\n        minZoom = 0,\n        maxZoom = 1.5,\n        initialZoom = 1,\n        cssReset = {},\n        img = self.refs.preview,\n        zoomer = self.refs.zoomer,\n        transformReset = new Transform(0, 0, initialZoom),\n        originReset = new TransformOrigin(),\n        isVisible = this._isVisible(self),\n        imgData,\n        vpData,\n        boundaryData,\n        minW,\n        minH;\n\n    if (!isVisible || self.data.bound) {\n      // if the croppie isn't visible or it doesn't need binding\n      console.warn(\"WHAAAAAAAAAAAAAAAAAAAAAAAAAAAT\");\n      return;\n    }\n\n    self.data.bound = true;\n    cssReset[StyleRelated.CSS_TRANSFORM] = transformReset.toString();\n    cssReset[StyleRelated.CSS_TRANS_ORG] = originReset.toString();\n    cssReset['opacity'] = 1;\n    this.setState({\n      previewStyle: cssReset\n    });\n    imgData = img.getBoundingClientRect();\n    vpData = self.refs.viewport.getBoundingClientRect();\n    boundaryData = self.refs.boundary.getBoundingClientRect();\n    self._originalImageWidth = imgData.width;\n    self._originalImageHeight = imgData.height;\n\n    if (self.props.enableZoom) {\n      if (self.props.enforceBoundary) {\n        minW = vpData.width / imgData.width;\n        minH = vpData.height / imgData.height;\n        minZoom = Math.max(minW, minH);\n      }\n\n      if (minZoom >= maxZoom) {\n        maxZoom = minZoom + 1;\n      }\n\n      zoomer.min = this.fix(minZoom, 4);\n      zoomer.max = this.fix(maxZoom, 4);\n      var defaultInitialZoom = Math.max(boundaryData.width / imgData.width, boundaryData.height / imgData.height);\n      initialZoom = self.data.boundZoom !== null ? self.data.boundZoom : defaultInitialZoom;\n\n      this._setZoomerVal(initialZoom);\n\n      this._currentZoom = initialZoom; //dispatchChange(zoomer);TODO\n    } else {\n      self._currentZoom = initialZoom;\n    }\n\n    transformReset.scale = self._currentZoom;\n    cssReset[StyleRelated.CSS_TRANSFORM] = transformReset.toString();\n    this.setState({\n      previewStyle: cssReset\n    });\n\n    if (self.data.points.length) {\n      console.warn(\"damn _bindPoints is called\"); //_bindPoints.call(self, self.data.points);\n    } else {\n      this._centerImage.call(self);\n    }\n\n    this._updateCenterPoint.call(self);\n\n    this._updateOverlay.call(self);\n  },\n  _isVisible: function _isVisible() {\n    //TODO\n    return this.refs.preview.offsetHeight > 0 && this.refs.preview.offsetWidth > 0;\n  },\n  _centerImage: function _centerImage() {\n    var self = this,\n        imgDim = self.refs.preview.getBoundingClientRect(),\n        vpDim = self.refs.viewport.getBoundingClientRect(),\n        boundDim = self.refs.boundary.getBoundingClientRect(),\n        vpLeft = vpDim.left - boundDim.left,\n        vpTop = vpDim.top - boundDim.top,\n        w = vpLeft - (imgDim.width - vpDim.width) / 2,\n        h = vpTop - (imgDim.height - vpDim.height) / 2,\n        transform = new Transform(w, h, self._currentZoom); //css(self.elements.preview, CSS_TRANSFORM, transform.toString());\n\n    var previewStyle = {};\n    previewStyle[StyleRelated.CSS_TRANSFORM] = transform.toString();\n    this.setState({\n      previewStyle: previewStyle\n    });\n  },\n  _updateCenterPoint: function _updateCenterPoint() {\n    var self = this,\n        scale = self._currentZoom,\n        data = self.refs.preview.getBoundingClientRect(),\n        vpData = self.refs.viewport.getBoundingClientRect(),\n        transform = Transform.parse(self.refs.preview.style[StyleRelated.CSS_TRANSFORM]),\n        pc = new TransformOrigin(self.refs.preview),\n        top = vpData.top - data.top + vpData.height / 2,\n        left = vpData.left - data.left + vpData.width / 2,\n        center = {},\n        adj = {};\n    center.y = top / scale;\n    center.x = left / scale;\n    adj.y = (center.y - pc.y) * (1 - scale);\n    adj.x = (center.x - pc.x) * (1 - scale);\n    transform.x -= adj.x;\n    transform.y -= adj.y;\n    var newCss = {};\n    newCss[StyleRelated.CSS_TRANS_ORG] = center.x + 'px ' + center.y + 'px';\n    newCss[StyleRelated.CSS_TRANSFORM] = transform.toString(); //css(self.elements.preview, newCss);\n\n    this.setState({\n      previewStyle: newCss\n    });\n  },\n  assignTransformCoordinates: function assignTransformCoordinates(deltaX, deltaY) {\n    var self = this;\n    var imgRect = self.refs.preview.getBoundingClientRect(),\n        top = this.transform.y + deltaY,\n        left = this.transform.x + deltaX;\n\n    if (self.props.enforceBoundary) {\n      if (this.vpRect.top > imgRect.top + deltaY && this.vpRect.bottom < imgRect.bottom + deltaY) {\n        this.transform.y = top;\n      }\n\n      if (this.vpRect.left > imgRect.left + deltaX && this.vpRect.right < imgRect.right + deltaX) {\n        this.transform.x = left;\n      }\n    } else {\n      this.transform.y = top;\n      this.transform.x = left;\n    }\n  },\n  RESULT_DEFAULTS: {\n    type: 'canvas',\n    format: 'png',\n    quality: 1\n  },\n  RESULT_FORMATS: ['jpeg', 'webp', 'png'],\n  result: function result(options) {\n    var self = this,\n        data = this._get(),\n        opts = deepExtend(deepExtend({}, this.RESULT_DEFAULTS), deepExtend({}, options)),\n        type = typeof options === 'string' ? options : opts.type || 'viewport',\n        size = opts.size,\n        format = opts.format,\n        quality = opts.quality,\n        backgroundColor = opts.backgroundColor,\n        circle = typeof opts.circle === 'boolean' ? opts.circle : self.props.viewport.type === 'circle',\n        vpRect = self.refs.viewport.getBoundingClientRect(),\n        ratio = vpRect.width / vpRect.height,\n        prom;\n\n    console.log(\"results defaults are\", this.RESULT_DEFAULTS);\n\n    if (size === 'viewport') {\n      data.outputWidth = vpRect.width;\n      data.outputHeight = vpRect.height;\n    } else if ((typeof size === \"undefined\" ? \"undefined\" : _typeof(size)) === 'object') {\n      if (size.width && size.height) {\n        data.outputWidth = size.width;\n        data.outputHeight = size.height;\n      } else if (size.width) {\n        data.outputWidth = size.width;\n        data.outputHeight = size.width / ratio;\n      } else if (size.height) {\n        data.outputWidth = size.height * ratio;\n        data.outputHeight = size.height;\n      }\n    }\n\n    if (this.RESULT_FORMATS.indexOf(format) > -1) {\n      data.format = 'image/' + format;\n      data.quality = quality;\n    }\n\n    data.circle = circle;\n    data.url = self.data.url;\n    data.backgroundColor = backgroundColor;\n    prom = new Promise(function (resolve, reject) {\n      if (type === 'rawCanvas') {\n        resolve(self._getCanvasResult(self.refs.preview, data));\n      }\n\n      if (type === 'canvas' || type == 'base64') {\n        resolve(self._getBase64Result(data));\n      } else if (type === 'blob') {\n        resolve(self._getBlobResult(data));\n      } else resolve(self._getHtmlResult(data));\n    });\n    return prom;\n  },\n  _getHtmlResult: function _getHtmlResult(data) {\n    var points = data.points;\n    return React.createElement(\"div\", {\n      className: \"croppie-result\",\n      style: {\n        width: points[2] - points[0],\n        height: points[3] - points[1]\n      }\n    }, React.createElement(\"img\", {\n      src: data.url,\n      style: {\n        left: -1 * points[0] + 'px',\n        top: -1 * points[1] + 'px'\n      }\n    }));\n  },\n  _getBase64Result: function _getBase64Result(data) {\n    var self = this;\n    return self._getCanvasResult(self.refs.preview, data).toDataURL(data.format, data.quality);\n  },\n  _getBlobResult: function _getBlobResult(data) {\n    var self = this;\n    return new Promise(function (resolve, reject) {\n      var canvasRes = self._getCanvasResult(self.refs.preview, data);\n\n      canvasRes.toBlob(function (blob) {\n        resolve(blob);\n      }, data.format, data.quality);\n    });\n  },\n  _get: function _get() {\n    //TODO\n    var self = this,\n        imgData = self.refs.preview.getBoundingClientRect(),\n        vpData = self.refs.viewport.getBoundingClientRect(),\n        x1 = vpData.left - imgData.left,\n        y1 = vpData.top - imgData.top,\n        widthDiff = (vpData.width - self.refs.viewport.offsetWidth) / 2,\n        heightDiff = (vpData.height - self.refs.viewport.offsetHeight) / 2,\n        x2 = x1 + self.refs.viewport.offsetWidth + widthDiff,\n        y2 = y1 + self.refs.viewport.offsetHeight + heightDiff,\n        scale = self._currentZoom;\n\n    if (scale === Infinity || isNaN(scale)) {\n      scale = 1;\n    }\n\n    var max = self.props.enforceBoundary ? 0 : Number.NEGATIVE_INFINITY;\n    x1 = Math.max(max, x1 / scale);\n    y1 = Math.max(max, y1 / scale);\n    x2 = Math.max(max, x2 / scale);\n    y2 = Math.max(max, y2 / scale);\n    return {\n      points: [this.fix(x1), this.fix(y1), this.fix(x2), this.fix(y2)],\n      zoom: scale\n    };\n  },\n  _getCanvasResult: function _getCanvasResult(img, data) {\n    var points = data.points,\n        left = points[0],\n        top = points[1],\n        width = points[2] - points[0],\n        height = points[3] - points[1],\n        circle = data.circle,\n        canvas = document.createElement('canvas'),\n        ctx = canvas.getContext('2d'),\n        outWidth = width,\n        outHeight = height;\n\n    if (data.outputWidth && data.outputHeight) {\n      outWidth = data.outputWidth;\n      outHeight = data.outputHeight;\n    }\n\n    canvas.width = outWidth;\n    canvas.height = outHeight;\n\n    if (data.backgroundColor) {\n      ctx.fillStyle = data.backgroundColor;\n      ctx.fillRect(0, 0, outWidth, outHeight);\n    }\n\n    ctx.drawImage(img, left, top, width, height, 0, 0, outWidth, outHeight);\n\n    if (circle) {\n      ctx.fillStyle = '#fff';\n      ctx.globalCompositeOperation = 'destination-in';\n      ctx.beginPath();\n      ctx.arc(outWidth / 2, outHeight / 2, outWidth / 2, 0, Math.PI * 2, true);\n      ctx.closePath();\n      ctx.fill();\n    }\n\n    return canvas;\n  }\n});\nmodule.exports = Croppie;\n\nfunction deepExtend(destination, source) {\n  destination = destination || {};\n\n  for (var property in source) {\n    if (!source.hasOwnProperty(property)) continue;\n\n    if (source[property] && source[property].constructor && source[property].constructor === Object) {\n      if (destination[property] && destination[property].constructor && destination[property].constructor === Object) deepExtend(destination[property], source[property]);else {\n        destination[property] = {};\n        deepExtend(destination[property], source[property]);\n      }\n    } else {\n      destination[property] = source[property];\n    }\n  }\n\n  return destination;\n}\n\nfunction cssExtend(source, old) {\n  for (var key in old) {\n    if (!old.hasOwnProperty(key)) continue;\n    if (!source[key]) source[key] = old[key];\n  }\n\n  return source;\n} //TODO","map":{"version":3,"sources":["C:/wamp64/www/INOVA/newsystem/manager/node_modules/react-croppie/lib/Croppie.react.js"],"names":["_typeof","Symbol","iterator","obj","constructor","React","require","ReactDOM","Transform","StyleRelated","TransformOrigin","el","style","CSS_TRANS_ORG","x","y","css","split","parseFloat","prototype","toString","Croppie","createClass","displayName","isDragging","originalX","originalY","originalDistance","vpRect","transform","_currentZoom","data","PropTypes","viewport","object","boundary","orientationControls","customClass","string","showZoomer","bool","enableZoom","mouseWheelZoom","enableExif","enforceBoundary","enableOrientation","update","func","url","getInitialState","componentDidMount","_bind","props","componentWillReceiveProps","nextProps","getDefaultProps","width","height","type","enabled","leftClass","rightClass","render","self","contClass","customViewportClass","preview","createElement","className","ref","state","previewStyle","src","onWheelFunc","onWheel","tabIndex","onKeyDown","keyDown","onTouchStart","mouseDown","onMouseDown","overlayStyle","step","display","onChange","changeZoom","ev","delta","targetZoom","wheelDelta","deltaY","detail","preventDefault","_setZoomerVal","pageX","pageY","touches","parse","refs","window","addEventListener","mouseMove","mouseUp","document","body","CSS_USERSELECT","getBoundingClientRect","LEFT_ARROW","UP_ARROW","RIGHT_ARROW","DOWN_ARROW","shiftKey","keyCode","zoom","zoomer","value","movement","parseKeyDown","keyMove","key","deltaX","newCss","assignTransformCoordinates","CSS_TRANSFORM","setState","_updateOverlay","_updateCenterPoint","length","touch1","touch2","dist","Math","sqrt","scale","call","cssExtend","setTimeout","_onZoom","origin","viewportRect","removeEventListener","boundRect","imgData","top","left","v","z","findDOMNode","val","fix","max","min","ui","elements","transCss","applyCss","boundaries","_getVirtualBoundaries","transBoundaries","translate","oBoundaries","maxX","minX","maxY","minY","vpWidth","vpHeight","centerFromBoundaryX","centerFromBoundaryY","imgRect","curImgWidth","curImgHeight","halfWidth","halfHeight","originMinX","originMaxX","originMinY","originMaxY","decimalPoints","toFixed","options","points","Array","isArray","slice","_updatePropertiesFromImage","bound","map","p","boundZoom","prom","loadImage","then","imageEl","img","Image","Promise","resolve","reject","substring","toLowerCase","setAttribute","onload","minZoom","maxZoom","initialZoom","cssReset","transformReset","originReset","isVisible","_isVisible","vpData","boundaryData","minW","minH","console","warn","_originalImageWidth","_originalImageHeight","defaultInitialZoom","_centerImage","offsetHeight","offsetWidth","imgDim","vpDim","boundDim","vpLeft","vpTop","w","h","pc","center","adj","bottom","right","RESULT_DEFAULTS","format","quality","RESULT_FORMATS","result","_get","opts","deepExtend","size","backgroundColor","circle","ratio","log","outputWidth","outputHeight","indexOf","_getCanvasResult","_getBase64Result","_getBlobResult","_getHtmlResult","toDataURL","canvasRes","toBlob","blob","x1","y1","widthDiff","heightDiff","x2","y2","Infinity","isNaN","Number","NEGATIVE_INFINITY","canvas","ctx","getContext","outWidth","outHeight","fillStyle","fillRect","drawImage","globalCompositeOperation","beginPath","arc","PI","closePath","fill","module","exports","destination","source","property","hasOwnProperty","Object","old"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nvar React = require(\"react\");\nvar ReactDOM = require(\"react-dom\");\n\nvar Transform = require(\"./Transform\");\nvar StyleRelated = require(\"./styleStuff\");\n\n///////////\nvar TransformOrigin = function TransformOrigin(el) {\n\tif (!el || !el.style[StyleRelated.CSS_TRANS_ORG]) {\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\treturn;\n\t}\n\tvar css = el.style[StyleRelated.CSS_TRANS_ORG].split(' ');\n\tthis.x = parseFloat(css[0]);\n\tthis.y = parseFloat(css[1]);\n};\n\nTransformOrigin.prototype.toString = function () {\n\treturn this.x + 'px ' + this.y + 'px';\n};\n//////////\n\n\nvar Croppie = React.createClass({\n\tdisplayName: \"Croppie\",\n\n\t//////////\n\tisDragging: false,\n\toriginalX: null,\n\toriginalY: null,\n\toriginalDistance: null,\n\tvpRect: null,\n\ttransform: null,\n\t_currentZoom: 1,\n\n\tdata: {}, //TODO\n\t//////////////\n\tPropTypes: {\n\t\tviewport: React.PropTypes.object, //TODO objectOf\n\t\tboundary: React.PropTypes.object, //TODO objectOf\n\t\torientationControls: React.PropTypes.object, //TODO objectOf\n\t\tcustomClass: React.PropTypes.string,\n\t\tshowZoomer: React.PropTypes.bool,\n\t\tenableZoom: React.PropTypes.bool,\n\t\tmouseWheelZoom: React.PropTypes.bool,\n\t\tenableExif: React.PropTypes.bool,\n\t\tenforceBoundary: React.PropTypes.bool,\n\t\tenableOrientation: React.PropTypes.bool,\n\t\tupdate: React.PropTypes.func,\n\t\turl: React.PropTypes.string\n\t},\n\tgetInitialState: function getInitialState() {\n\t\treturn {};\n\t},\n\tcomponentDidMount: function componentDidMount() {\n\t\tthis._bind(this.props.url);\n\t},\n\tcomponentWillReceiveProps: function componentWillReceiveProps(nextProps) {\n\t\tif (nextProps.url !== this.props.url) this._bind(nextProps.url);\n\t},\n\tgetDefaultProps: function getDefaultProps() {\n\t\treturn {\n\t\t\tviewport: {\n\t\t\t\twidth: 100,\n\t\t\t\theight: 100,\n\t\t\t\ttype: 'circle'\n\t\t\t},\n\t\t\tboundary: {\n\t\t\t\twidth: 300,\n\t\t\t\theight: 300\n\t\t\t},\n\t\t\torientationControls: {\n\t\t\t\tenabled: true,\n\t\t\t\tleftClass: '',\n\t\t\t\trightClass: ''\n\t\t\t},\n\t\t\tcustomClass: '',\n\t\t\tshowZoomer: true,\n\t\t\tenableZoom: true,\n\t\t\tmouseWheelZoom: true,\n\t\t\tenableExif: false,\n\t\t\tenforceBoundary: true,\n\t\t\tenableOrientation: false,\n\t\t\tupdate: function update() {}\n\t\t};\n\t},\n\trender: function render() {\n\t\tvar self = this,\n\t\t    contClass = 'croppie-container',\n\t\t    customViewportClass = this.props.viewport.type ? 'cr-vp-' + this.props.viewport.type : \" \",\n\t\t    preview;\n\t\tif (self.props.enableOrientation) preview = React.createElement(\n\t\t\t\"canvas\",\n\t\t\t{ className: \"cr-image\", ref: \"preview\", style: this.state.previewStyle || {} },\n\t\t\t\" \"\n\t\t);else preview = React.createElement(\"img\", { src: \"\", className: \"cr-image\", ref: \"preview\", style: this.state.previewStyle || {} });\n\n\t\tvar onWheelFunc = this.props.enableZoom ? this.onWheel : function () {};\n\t\treturn React.createElement(\n\t\t\t\"div\",\n\t\t\t{ className: contClass },\n\t\t\tReact.createElement(\n\t\t\t\t\"div\",\n\t\t\t\t{ className: \"cr-boundary\",\n\t\t\t\t\tref: \"boundary\",\n\t\t\t\t\tstyle: { width: this.props.boundary.width, height: this.props.boundary.height },\n\t\t\t\t\tonWheel: onWheelFunc\n\t\t\t\t},\n\t\t\t\tpreview,\n\t\t\t\tReact.createElement(\"div\", { tabIndex: \"0\",\n\t\t\t\t\tonKeyDown: this.keyDown,\n\t\t\t\t\tref: \"viewport\",\n\t\t\t\t\tclassName: \"cr-viewport \" + customViewportClass,\n\t\t\t\t\tstyle: { width: this.props.viewport.width, height: this.props.viewport.height }\n\t\t\t\t}),\n\t\t\t\tReact.createElement(\"div\", { className: \"cr-overlay\",\n\t\t\t\t\tonTouchStart: this.mouseDown,\n\t\t\t\t\tonMouseDown: this.mouseDown,\n\t\t\t\t\tstyle: this.state.overlayStyle\n\t\t\t\t})\n\t\t\t),\n\t\t\tthis.props.enableZoom && React.createElement(\n\t\t\t\t\"div\",\n\t\t\t\t{ className: \"cr-slider-wrap\" },\n\t\t\t\tReact.createElement(\"input\", { type: \"range\",\n\t\t\t\t\tclassName: \"cr-slider\",\n\t\t\t\t\tstep: \"0.0001\",\n\t\t\t\t\tstyle: { display: this.props.showZoomer ? \"\" : \"none\" },\n\t\t\t\t\tonChange: this.changeZoom,\n\t\t\t\t\tref: \"zoomer\"\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\t},\n\tonWheel: function onWheel(ev) {\n\t\tvar self = this;\n\t\tvar delta, targetZoom;\n\n\t\tif (ev.wheelDelta) {\n\t\t\tdelta = ev.wheelDelta / 1200; //wheelDelta min: -120 max: 120 // max x 10 x 2\n\t\t} else if (ev.deltaY) {\n\t\t\tdelta = ev.deltaY / 1060; //deltaY min: -53 max: 53 // max x 10 x 2\n\t\t} else if (ev.detail) {\n\t\t\tdelta = ev.detail / -60; //delta min: -3 max: 3 // max x 10 x 2\n\t\t} else {\n\t\t\tdelta = 0;\n\t\t}\n\t\ttargetZoom = self._currentZoom + delta;\n\n\t\tev.preventDefault();\n\t\tthis._setZoomerVal(targetZoom);\n\t\tthis.changeZoom();\n\t},\n\tmouseDown: function mouseDown(ev) {\n\t\tev.preventDefault();\n\t\tif (this.isDragging) return;\n\n\t\tthis.isDragging = true;\n\t\tthis.originalX = ev.pageX;\n\t\tthis.originalY = ev.pageY;\n\t\tif (ev.touches) {\n\t\t\tvar touches = ev.touches[0];\n\t\t\tthis.originalX = touches.pageX;\n\t\t\tthis.originalY = touches.pageY;\n\t\t}\n\n\t\tthis.transform = Transform.parse(this.refs.preview);\n\t\twindow.addEventListener('mousemove', this.mouseMove);\n\t\twindow.addEventListener('touchmove', this.mouseMove);\n\t\twindow.addEventListener('mouseup', this.mouseUp);\n\t\twindow.addEventListener('touchend', this.mouseUp);\n\n\t\tdocument.body.style[StyleRelated.CSS_USERSELECT] = 'none';\n\t\tthis.vpRect = this.refs.viewport.getBoundingClientRect();\n\t},\n\tkeyDown: function keyDown(ev) {\n\t\tvar self = this;\n\t\tvar LEFT_ARROW = 37,\n\t\t    UP_ARROW = 38,\n\t\t    RIGHT_ARROW = 39,\n\t\t    DOWN_ARROW = 40;\n\n\t\tif (ev.shiftKey && (ev.keyCode == UP_ARROW || ev.keyCode == DOWN_ARROW)) {\n\t\t\tvar zoom = 0.0;\n\t\t\tif (ev.keyCode == UP_ARROW) {\n\t\t\t\tzoom = parseFloat(self.refs.zoomer.value, 10) + parseFloat(self.refs.zoomer.step, 10);\n\t\t\t} else {\n\t\t\t\tzoom = parseFloat(self.refs.zoomer.value, 10) - parseFloat(self.refs.zoomer.step, 10);\n\t\t\t}\n\t\t\t// self.setZoom(zoom);\n\t\t\tself._setZoomerVal(zoom);\n\t\t} else if (ev.keyCode >= 37 && ev.keyCode <= 40) {\n\t\t\tev.preventDefault();\n\t\t\tvar movement = parseKeyDown(ev.keyCode);\n\n\t\t\tself.transform = Transform.parse(self.refs.preview);\n\t\t\tdocument.body.style[StyleRelated.CSS_USERSELECT] = 'none';\n\t\t\tself.vpRect = self.refs.viewport.getBoundingClientRect();\n\t\t\tself.keyMove(movement);\n\t\t}\n\n\t\tfunction parseKeyDown(key) {\n\t\t\tswitch (key) {\n\t\t\t\tcase LEFT_ARROW:\n\t\t\t\t\treturn [1, 0];\n\t\t\t\tcase UP_ARROW:\n\t\t\t\t\treturn [0, 1];\n\t\t\t\tcase RIGHT_ARROW:\n\t\t\t\t\treturn [-1, 0];\n\t\t\t\tcase DOWN_ARROW:\n\t\t\t\t\treturn [0, -1];\n\t\t\t}\n\t\t}\n\t},\n\tkeyMove: function keyMove(movement) {\n\t\tvar deltaX = movement[0],\n\t\t    deltaY = movement[1],\n\t\t    newCss = {};\n\n\t\tthis.assignTransformCoordinates(deltaX, deltaY);\n\n\t\tnewCss[StyleRelated.CSS_TRANSFORM] = this.transform.toString();\n\t\t// css(self.elements.preview, newCss);\n\t\tthis.setState({\n\t\t\tpreviewStyle: newCss\n\t\t});\n\t\tthis._updateOverlay();\n\t\tdocument.body.style[StyleRelated.CSS_USERSELECT] = '';\n\t\tthis._updateCenterPoint();\n\t\t// _triggerUpdate.call(self);TODO\n\t\tthis.originalDistance = 0;\n\t},\n\tmouseMove: function mouseMove(ev) {\n\n\t\tev.preventDefault();\n\t\tvar pageX = ev.pageX,\n\t\t    pageY = ev.pageY;\n\n\t\tif (ev.touches) {\n\t\t\tvar touches = ev.touches[0];\n\t\t\tpageX = touches.pageX;\n\t\t\tpageY = touches.pageY;\n\t\t}\n\n\t\tvar deltaX = pageX - this.originalX,\n\t\t    deltaY = pageY - this.originalY,\n\t\t    newCss = {};\n\t\tif (ev.type == 'touchmove') {\n\t\t\tif (ev.touches.length > 1) {\n\t\t\t\tvar touch1 = ev.touches[0];\n\t\t\t\tvar touch2 = ev.touches[1];\n\t\t\t\tvar dist = Math.sqrt((touch1.pageX - touch2.pageX) * (touch1.pageX - touch2.pageX) + (touch1.pageY - touch2.pageY) * (touch1.pageY - touch2.pageY));\n\n\t\t\t\tif (!this.originalDistance) {\n\t\t\t\t\tthis.originalDistance = dist / self._currentZoom;\n\t\t\t\t}\n\n\t\t\t\tvar scale = dist / this.originalDistance;\n\n\t\t\t\tthis._setZoomerVal.call(self, scale);\n\t\t\t\t//dispatchChange(self.elements.zoomer);TODO\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.assignTransformCoordinates(deltaX, deltaY);\n\t\tnewCss[StyleRelated.CSS_TRANSFORM] = this.transform.toString();\n\t\t//css(self.elements.preview, newCss);\n\n\t\tthis.setState({\n\t\t\tpreviewStyle: cssExtend(newCss, this.state.previewStyle)\n\t\t});\n\n\t\tsetTimeout(this._updateOverlay, 0);\n\t\tthis.originalY = pageY;\n\t\tthis.originalX = pageX;\n\t},\n\tchangeZoom: function changeZoom() {\n\t\tvar self = this;\n\t\tthis._onZoom({\n\t\t\tvalue: parseFloat(this.refs.zoomer.value),\n\t\t\torigin: new TransformOrigin(self.refs.preview),\n\t\t\tviewportRect: self.refs.viewport.getBoundingClientRect(),\n\t\t\ttransform: Transform.parse(self.refs.preview)\n\t\t});\n\t},\n\tmouseUp: function mouseUp() {\n\t\tthis.isDragging = false;\n\t\twindow.removeEventListener('mousemove', this.mouseMove);\n\t\twindow.removeEventListener('touchmove', this.mouseMove);\n\t\twindow.removeEventListener('mouseup', this.mouseUp);\n\t\twindow.removeEventListener('touchend', this.mouseUp);\n\t\tdocument.body.style[StyleRelated.CSS_USERSELECT] = '';\n\t\tthis._updateCenterPoint();\n\t\t// this._triggerUpdate.call(self);TODO\n\t\tthis.originalDistance = 0;\n\t},\n\t_updateOverlay: function _updateOverlay() {\n\t\tvar boundRect = this.refs.boundary.getBoundingClientRect(),\n\t\t    imgData = this.refs.preview.getBoundingClientRect();\n\n\t\tthis.setState({\n\t\t\toverlayStyle: {\n\t\t\t\twidth: imgData.width + 'px',\n\t\t\t\theight: imgData.height + 'px',\n\t\t\t\ttop: imgData.top - boundRect.top + 'px',\n\t\t\t\tleft: imgData.left - boundRect.left + 'px'\n\t\t\t}\n\t\t});\n\t},\n\t_setZoomerVal: function _setZoomerVal(v) {\n\t\t//TODO\n\t\tif (this.props.enableZoom) {\n\t\t\tvar z = ReactDOM.findDOMNode(this.refs.zoomer),\n\t\t\t    val = this.fix(v, 4);\n\t\t\tz.value = Math.max(z.min, Math.min(z.max, val));\n\t\t}\n\t},\n\t_onZoom: function _onZoom(ui) {\n\t\tvar self = this,\n\t\t    transform = ui ? ui.transform : Transform.parse(ReactDOM.findDOMNode(this.refs.preview)),\n\t\t    vpRect = ui ? ui.viewportRect : self.refs.elements.viewport.getBoundingClientRect(),\n\t\t    //TODO does this need this.vpRect\n\t\torigin = ui ? ui.origin : new TransformOrigin(ReactDOM.findDOMNode(this.refs.preview)),\n\t\t    transCss = {};\n\n\t\tfunction applyCss() {\n\t\t\tvar transCss = {};\n\t\t\ttransCss[StyleRelated.CSS_TRANSFORM] = transform.toString();\n\t\t\ttransCss[StyleRelated.CSS_TRANS_ORG] = origin.toString();\n\t\t\tself.setState({\n\t\t\t\tpreviewStyle: transCss\n\t\t\t});\n\t\t}\n\n\t\tself._currentZoom = ui ? ui.value : self._currentZoom;\n\t\ttransform.scale = self._currentZoom;\n\t\tapplyCss();\n\n\t\tif (this.props.enforceBoundary) {\n\t\t\tvar boundaries = this._getVirtualBoundaries(vpRect),\n\t\t\t    transBoundaries = boundaries.translate,\n\t\t\t    oBoundaries = boundaries.origin;\n\n\t\t\tif (transform.x >= transBoundaries.maxX) {\n\t\t\t\torigin.x = oBoundaries.minX;\n\t\t\t\ttransform.x = transBoundaries.maxX;\n\t\t\t}\n\n\t\t\tif (transform.x <= transBoundaries.minX) {\n\t\t\t\torigin.x = oBoundaries.maxX;\n\t\t\t\ttransform.x = transBoundaries.minX;\n\t\t\t}\n\n\t\t\tif (transform.y >= transBoundaries.maxY) {\n\t\t\t\torigin.y = oBoundaries.minY;\n\t\t\t\ttransform.y = transBoundaries.maxY;\n\t\t\t}\n\n\t\t\tif (transform.y <= transBoundaries.minY) {\n\t\t\t\torigin.y = oBoundaries.maxY;\n\t\t\t\ttransform.y = transBoundaries.minY;\n\t\t\t}\n\t\t}\n\t\tapplyCss();\n\t\tsetTimeout(this._updateOverlay, 0);\n\n\t\t//_triggerUpdate.call(self); TODO\n\t},\n\t_getVirtualBoundaries: function _getVirtualBoundaries(viewport) {\n\t\t//TODO\n\t\tvar self = this,\n\t\t    scale = self._currentZoom,\n\t\t    vpWidth = viewport.width,\n\t\t    vpHeight = viewport.height,\n\t\t    centerFromBoundaryX = self.props.boundary.width / 2,\n\t\t    centerFromBoundaryY = self.props.boundary.height / 2,\n\t\t    imgRect = self.refs.preview.getBoundingClientRect(),\n\t\t    curImgWidth = imgRect.width,\n\t\t    curImgHeight = imgRect.height,\n\t\t    halfWidth = vpWidth / 2,\n\t\t    halfHeight = vpHeight / 2;\n\n\t\tvar maxX = (halfWidth / scale - centerFromBoundaryX) * -1;\n\t\tvar minX = maxX - (curImgWidth * (1 / scale) - vpWidth * (1 / scale));\n\n\t\tvar maxY = (halfHeight / scale - centerFromBoundaryY) * -1;\n\t\tvar minY = maxY - (curImgHeight * (1 / scale) - vpHeight * (1 / scale));\n\n\t\tvar originMinX = 1 / scale * halfWidth;\n\t\tvar originMaxX = curImgWidth * (1 / scale) - originMinX;\n\n\t\tvar originMinY = 1 / scale * halfHeight;\n\t\tvar originMaxY = curImgHeight * (1 / scale) - originMinY;\n\n\t\treturn {\n\t\t\ttranslate: {\n\t\t\t\tmaxX: maxX,\n\t\t\t\tminX: minX,\n\t\t\t\tmaxY: maxY,\n\t\t\t\tminY: minY\n\t\t\t},\n\t\t\torigin: {\n\t\t\t\tmaxX: originMaxX,\n\t\t\t\tminX: originMinX,\n\t\t\t\tmaxY: originMaxY,\n\t\t\t\tminY: originMinY\n\t\t\t}\n\t\t};\n\t},\n\tfix: function fix(v, decimalPoints) {\n\t\treturn parseFloat(v).toFixed(decimalPoints || 0);\n\t},\n\t_bind: function _bind(options) {\n\t\tvar self = this,\n\t\t    url,\n\t\t    points = [],\n\t\t    zoom = null;\n\n\t\tif (typeof options === 'string') {\n\t\t\turl = options;\n\t\t\toptions = {};\n\t\t} else if (Array.isArray(options)) {\n\t\t\tpoints = options.slice();\n\t\t} else if (typeof options == 'undefined' && self.data.url) {\n\t\t\t//refreshing TODO\n\t\t\tthis._updatePropertiesFromImage.call(self);\n\t\t\t// _triggerUpdate.call(self);TODO\n\t\t\treturn null;\n\t\t} else {\n\t\t\turl = options.url;\n\t\t\tpoints = options.points || [];\n\t\t\tzoom = typeof options.zoom === 'undefined' ? null : options.zoom;\n\t\t}\n\n\t\tself.data.bound = false;\n\t\tself.data.url = url || self.data.url;\n\t\tself.data.points = (points || self.data.points).map(function (p) {\n\t\t\treturn parseFloat(p);\n\t\t});\n\t\tself.data.boundZoom = zoom;\n\t\tvar prom = this.loadImage(url, self.refs.preview);\n\t\tprom.then(function () {\n\t\t\tself._updatePropertiesFromImage.call(self);\n\t\t\t// _triggerUpdate.call(self);TODO\n\t\t});\n\t\treturn prom;\n\t},\n\tloadImage: function loadImage(src, imageEl) {\n\t\tvar self = this;\n\t\tvar img = imageEl || new Image(),\n\t\t    prom;\n\n\t\tif (img.src === src) {\n\t\t\t// If image source hasn't changed, return a promise that resolves immediately\n\t\t\tprom = new Promise(function (resolve, reject) {\n\t\t\t\tresolve(img);\n\t\t\t});\n\t\t} else {\n\t\t\tprom = new Promise(function (resolve, reject) {\n\t\t\t\tif (self.props.enableOrientation && src.substring(0, 4).toLowerCase() === 'http') {\n\t\t\t\t\timg.setAttribute('crossOrigin', 'anonymous');\n\t\t\t\t}\n\t\t\t\timg.onload = function () {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tresolve(img);\n\t\t\t\t\t}, 1);\n\t\t\t\t};\n\t\t\t});\n\n\t\t\timg.src = src;\n\t\t}\n\n\t\treturn prom;\n\t},\n\t_updatePropertiesFromImage: function _updatePropertiesFromImage() {\n\t\tvar self = this,\n\t\t    minZoom = 0,\n\t\t    maxZoom = 1.5,\n\t\t    initialZoom = 1,\n\t\t    cssReset = {},\n\t\t    img = self.refs.preview,\n\t\t    zoomer = self.refs.zoomer,\n\t\t    transformReset = new Transform(0, 0, initialZoom),\n\t\t    originReset = new TransformOrigin(),\n\t\t    isVisible = this._isVisible(self),\n\t\t    imgData,\n\t\t    vpData,\n\t\t    boundaryData,\n\t\t    minW,\n\t\t    minH;\n\n\t\tif (!isVisible || self.data.bound) {\n\t\t\t// if the croppie isn't visible or it doesn't need binding\n\t\t\tconsole.warn(\"WHAAAAAAAAAAAAAAAAAAAAAAAAAAAT\");\n\t\t\treturn;\n\t\t}\n\n\t\tself.data.bound = true;\n\t\tcssReset[StyleRelated.CSS_TRANSFORM] = transformReset.toString();\n\t\tcssReset[StyleRelated.CSS_TRANS_ORG] = originReset.toString();\n\t\tcssReset['opacity'] = 1;\n\t\tthis.setState({\n\t\t\tpreviewStyle: cssReset\n\t\t});\n\n\t\timgData = img.getBoundingClientRect();\n\t\tvpData = self.refs.viewport.getBoundingClientRect();\n\t\tboundaryData = self.refs.boundary.getBoundingClientRect();\n\t\tself._originalImageWidth = imgData.width;\n\t\tself._originalImageHeight = imgData.height;\n\n\t\tif (self.props.enableZoom) {\n\t\t\tif (self.props.enforceBoundary) {\n\t\t\t\tminW = vpData.width / imgData.width;\n\t\t\t\tminH = vpData.height / imgData.height;\n\t\t\t\tminZoom = Math.max(minW, minH);\n\t\t\t}\n\n\t\t\tif (minZoom >= maxZoom) {\n\t\t\t\tmaxZoom = minZoom + 1;\n\t\t\t}\n\n\t\t\tzoomer.min = this.fix(minZoom, 4);\n\t\t\tzoomer.max = this.fix(maxZoom, 4);\n\t\t\tvar defaultInitialZoom = Math.max(boundaryData.width / imgData.width, boundaryData.height / imgData.height);\n\t\t\tinitialZoom = self.data.boundZoom !== null ? self.data.boundZoom : defaultInitialZoom;\n\t\t\tthis._setZoomerVal(initialZoom);\n\t\t\tthis._currentZoom = initialZoom;\n\t\t\t//dispatchChange(zoomer);TODO\n\t\t} else {\n\t\t\tself._currentZoom = initialZoom;\n\t\t}\n\n\t\ttransformReset.scale = self._currentZoom;\n\t\tcssReset[StyleRelated.CSS_TRANSFORM] = transformReset.toString();\n\t\tthis.setState({\n\t\t\tpreviewStyle: cssReset\n\t\t});\n\n\t\tif (self.data.points.length) {\n\t\t\tconsole.warn(\"damn _bindPoints is called\");\n\t\t\t//_bindPoints.call(self, self.data.points);\n\t\t} else {\n\t\t\tthis._centerImage.call(self);\n\t\t}\n\n\t\tthis._updateCenterPoint.call(self);\n\t\tthis._updateOverlay.call(self);\n\t},\n\t_isVisible: function _isVisible() {\n\t\t//TODO\n\t\treturn this.refs.preview.offsetHeight > 0 && this.refs.preview.offsetWidth > 0;\n\t},\n\t_centerImage: function _centerImage() {\n\t\tvar self = this,\n\t\t    imgDim = self.refs.preview.getBoundingClientRect(),\n\t\t    vpDim = self.refs.viewport.getBoundingClientRect(),\n\t\t    boundDim = self.refs.boundary.getBoundingClientRect(),\n\t\t    vpLeft = vpDim.left - boundDim.left,\n\t\t    vpTop = vpDim.top - boundDim.top,\n\t\t    w = vpLeft - (imgDim.width - vpDim.width) / 2,\n\t\t    h = vpTop - (imgDim.height - vpDim.height) / 2,\n\t\t    transform = new Transform(w, h, self._currentZoom);\n\n\t\t//css(self.elements.preview, CSS_TRANSFORM, transform.toString());\n\t\tvar previewStyle = {};\n\t\tpreviewStyle[StyleRelated.CSS_TRANSFORM] = transform.toString();\n\t\tthis.setState({\n\t\t\tpreviewStyle: previewStyle\n\t\t});\n\t},\n\t_updateCenterPoint: function _updateCenterPoint() {\n\t\tvar self = this,\n\t\t    scale = self._currentZoom,\n\t\t    data = self.refs.preview.getBoundingClientRect(),\n\t\t    vpData = self.refs.viewport.getBoundingClientRect(),\n\t\t    transform = Transform.parse(self.refs.preview.style[StyleRelated.CSS_TRANSFORM]),\n\t\t    pc = new TransformOrigin(self.refs.preview),\n\t\t    top = vpData.top - data.top + vpData.height / 2,\n\t\t    left = vpData.left - data.left + vpData.width / 2,\n\t\t    center = {},\n\t\t    adj = {};\n\n\t\tcenter.y = top / scale;\n\t\tcenter.x = left / scale;\n\t\tadj.y = (center.y - pc.y) * (1 - scale);\n\t\tadj.x = (center.x - pc.x) * (1 - scale);\n\n\t\ttransform.x -= adj.x;\n\t\ttransform.y -= adj.y;\n\n\t\tvar newCss = {};\n\t\tnewCss[StyleRelated.CSS_TRANS_ORG] = center.x + 'px ' + center.y + 'px';\n\t\tnewCss[StyleRelated.CSS_TRANSFORM] = transform.toString();\n\t\t//css(self.elements.preview, newCss);\n\t\tthis.setState({\n\t\t\tpreviewStyle: newCss\n\t\t});\n\t},\n\tassignTransformCoordinates: function assignTransformCoordinates(deltaX, deltaY) {\n\t\tvar self = this;\n\t\tvar imgRect = self.refs.preview.getBoundingClientRect(),\n\t\t    top = this.transform.y + deltaY,\n\t\t    left = this.transform.x + deltaX;\n\n\t\tif (self.props.enforceBoundary) {\n\t\t\tif (this.vpRect.top > imgRect.top + deltaY && this.vpRect.bottom < imgRect.bottom + deltaY) {\n\t\t\t\tthis.transform.y = top;\n\t\t\t}\n\n\t\t\tif (this.vpRect.left > imgRect.left + deltaX && this.vpRect.right < imgRect.right + deltaX) {\n\t\t\t\tthis.transform.x = left;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.transform.y = top;\n\t\t\tthis.transform.x = left;\n\t\t}\n\t},\n\n\tRESULT_DEFAULTS: {\n\t\ttype: 'canvas',\n\t\tformat: 'png',\n\t\tquality: 1\n\t},\n\tRESULT_FORMATS: ['jpeg', 'webp', 'png'],\n\tresult: function result(options) {\n\t\tvar self = this,\n\t\t    data = this._get(),\n\t\t    opts = deepExtend(deepExtend({}, this.RESULT_DEFAULTS), deepExtend({}, options)),\n\t\t    type = typeof options === 'string' ? options : opts.type || 'viewport',\n\t\t    size = opts.size,\n\t\t    format = opts.format,\n\t\t    quality = opts.quality,\n\t\t    backgroundColor = opts.backgroundColor,\n\t\t    circle = typeof opts.circle === 'boolean' ? opts.circle : self.props.viewport.type === 'circle',\n\t\t    vpRect = self.refs.viewport.getBoundingClientRect(),\n\t\t    ratio = vpRect.width / vpRect.height,\n\t\t    prom;\n\t\tconsole.log(\"results defaults are\", this.RESULT_DEFAULTS);\n\t\tif (size === 'viewport') {\n\t\t\tdata.outputWidth = vpRect.width;\n\t\t\tdata.outputHeight = vpRect.height;\n\t\t} else if ((typeof size === \"undefined\" ? \"undefined\" : _typeof(size)) === 'object') {\n\t\t\tif (size.width && size.height) {\n\t\t\t\tdata.outputWidth = size.width;\n\t\t\t\tdata.outputHeight = size.height;\n\t\t\t} else if (size.width) {\n\t\t\t\tdata.outputWidth = size.width;\n\t\t\t\tdata.outputHeight = size.width / ratio;\n\t\t\t} else if (size.height) {\n\t\t\t\tdata.outputWidth = size.height * ratio;\n\t\t\t\tdata.outputHeight = size.height;\n\t\t\t}\n\t\t}\n\n\t\tif (this.RESULT_FORMATS.indexOf(format) > -1) {\n\t\t\tdata.format = 'image/' + format;\n\t\t\tdata.quality = quality;\n\t\t}\n\n\t\tdata.circle = circle;\n\t\tdata.url = self.data.url;\n\t\tdata.backgroundColor = backgroundColor;\n\n\t\tprom = new Promise(function (resolve, reject) {\n\t\t\tif (type === 'rawCanvas') {\n\t\t\t\tresolve(self._getCanvasResult(self.refs.preview, data));\n\t\t\t}\n\t\t\tif (type === 'canvas' || type == 'base64') {\n\t\t\t\tresolve(self._getBase64Result(data));\n\t\t\t} else if (type === 'blob') {\n\t\t\t\tresolve(self._getBlobResult(data));\n\t\t\t} else resolve(self._getHtmlResult(data));\n\t\t});\n\t\treturn prom;\n\t},\n\t_getHtmlResult: function _getHtmlResult(data) {\n\t\tvar points = data.points;\n\t\treturn React.createElement(\n\t\t\t\"div\",\n\t\t\t{ className: \"croppie-result\", style: { width: points[2] - points[0], height: points[3] - points[1] } },\n\t\t\tReact.createElement(\"img\", { src: data.url, style: { left: -1 * points[0] + 'px', top: -1 * points[1] + 'px' } })\n\t\t);\n\t},\n\t_getBase64Result: function _getBase64Result(data) {\n\t\tvar self = this;\n\t\treturn self._getCanvasResult(self.refs.preview, data).toDataURL(data.format, data.quality);\n\t},\n\t_getBlobResult: function _getBlobResult(data) {\n\t\tvar self = this;\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tvar canvasRes = self._getCanvasResult(self.refs.preview, data);\n\t\t\tcanvasRes.toBlob(function (blob) {\n\t\t\t\tresolve(blob);\n\t\t\t}, data.format, data.quality);\n\t\t});\n\t},\n\t_get: function _get() {\n\t\t//TODO\n\t\tvar self = this,\n\t\t    imgData = self.refs.preview.getBoundingClientRect(),\n\t\t    vpData = self.refs.viewport.getBoundingClientRect(),\n\t\t    x1 = vpData.left - imgData.left,\n\t\t    y1 = vpData.top - imgData.top,\n\t\t    widthDiff = (vpData.width - self.refs.viewport.offsetWidth) / 2,\n\t\t    heightDiff = (vpData.height - self.refs.viewport.offsetHeight) / 2,\n\t\t    x2 = x1 + self.refs.viewport.offsetWidth + widthDiff,\n\t\t    y2 = y1 + self.refs.viewport.offsetHeight + heightDiff,\n\t\t    scale = self._currentZoom;\n\n\t\tif (scale === Infinity || isNaN(scale)) {\n\t\t\tscale = 1;\n\t\t}\n\n\t\tvar max = self.props.enforceBoundary ? 0 : Number.NEGATIVE_INFINITY;\n\t\tx1 = Math.max(max, x1 / scale);\n\t\ty1 = Math.max(max, y1 / scale);\n\t\tx2 = Math.max(max, x2 / scale);\n\t\ty2 = Math.max(max, y2 / scale);\n\n\t\treturn {\n\t\t\tpoints: [this.fix(x1), this.fix(y1), this.fix(x2), this.fix(y2)],\n\t\t\tzoom: scale\n\t\t};\n\t},\n\t_getCanvasResult: function _getCanvasResult(img, data) {\n\t\tvar points = data.points,\n\t\t    left = points[0],\n\t\t    top = points[1],\n\t\t    width = points[2] - points[0],\n\t\t    height = points[3] - points[1],\n\t\t    circle = data.circle,\n\t\t    canvas = document.createElement('canvas'),\n\t\t    ctx = canvas.getContext('2d'),\n\t\t    outWidth = width,\n\t\t    outHeight = height;\n\n\t\tif (data.outputWidth && data.outputHeight) {\n\t\t\toutWidth = data.outputWidth;\n\t\t\toutHeight = data.outputHeight;\n\t\t}\n\n\t\tcanvas.width = outWidth;\n\t\tcanvas.height = outHeight;\n\n\t\tif (data.backgroundColor) {\n\t\t\tctx.fillStyle = data.backgroundColor;\n\t\t\tctx.fillRect(0, 0, outWidth, outHeight);\n\t\t}\n\t\tctx.drawImage(img, left, top, width, height, 0, 0, outWidth, outHeight);\n\t\tif (circle) {\n\t\t\tctx.fillStyle = '#fff';\n\t\t\tctx.globalCompositeOperation = 'destination-in';\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(outWidth / 2, outHeight / 2, outWidth / 2, 0, Math.PI * 2, true);\n\t\t\tctx.closePath();\n\t\t\tctx.fill();\n\t\t}\n\t\treturn canvas;\n\t}\n});\n\nmodule.exports = Croppie;\n\nfunction deepExtend(destination, source) {\n\tdestination = destination || {};\n\tfor (var property in source) {\n\t\tif (!source.hasOwnProperty(property)) continue;\n\t\tif (source[property] && source[property].constructor && source[property].constructor === Object) {\n\t\t\tif (destination[property] && destination[property].constructor && destination[property].constructor === Object) deepExtend(destination[property], source[property]);else {\n\t\t\t\tdestination[property] = {};\n\t\t\t\tdeepExtend(destination[property], source[property]);\n\t\t\t}\n\t\t} else {\n\t\t\tdestination[property] = source[property];\n\t\t}\n\t}\n\treturn destination;\n}\n\nfunction cssExtend(source, old) {\n\tfor (var key in old) {\n\t\tif (!old.hasOwnProperty(key)) continue;\n\t\tif (!source[key]) source[key] = old[key];\n\t}\n\treturn source;\n}\n//TODO"]},"metadata":{},"sourceType":"script"}