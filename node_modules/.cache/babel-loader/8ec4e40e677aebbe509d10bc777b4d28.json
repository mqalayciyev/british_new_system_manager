{"ast":null,"code":"import _slicedToArray from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/wamp64/www/INOVA/newsystem/manager/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import axios from'axios';import{Link}from\"react-router-dom\";import{NotificationContainer,NotificationManager}from'react-notifications';import'react-notifications/lib/notifications.css';import queryString from'query-string';import img from'../../img/profile.jpg';// import FileBase64 from 'react-file-base64';\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Chat=/*#__PURE__*/function(_Component){_inherits(Chat,_Component);var _super=_createSuper(Chat);function Chat(props){var _this;_classCallCheck(this,Chat);_this=_super.call(this,props);_this.componentDidMount=function(){_this.load();};_this.load=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(name){var pathname,id,userInfo,newFormData,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:pathname=window.location.pathname.split('/');id=pathname[pathname.length-1];userInfo=JSON.parse(localStorage.getItem('user-info'));newFormData=_this.state.formData;newFormData['userid']=id;_this.setState({formData:newFormData});_this.setState({userid:id,myid:userInfo.user.user_info.id});axios.interceptors.request.use(function(config){config.headers.authorization=\"Bearer \".concat(userInfo.user.token);return config;},function(error){return Promise.reject(error);});_context.next=10;return axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/managers/messages/\").concat(id));case 10:response=_context.sent;if(response.data.status==='success'){_this.setState({chat:response.data.chat,user:response.data.user,display:false});_this.messageRender();}case 12:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleFormData=function(event){var value=event.target.value;var name=event.target.name;var newFormData=_this.state.formData;if(value===''){delete newFormData[\"\".concat(name)];}else{newFormData[name]=value;}_this.setState({formData:newFormData});};_this.sendForm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var formData,userInfo,response,message,_i,_Object$entries,_Object$entries$_i,key,value;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();formData=new FormData();if(_this.state.formData.file)formData.append(\"file\",_this.state.formData.file);if(_this.state.formData.userid)formData.append(\"userid\",_this.state.formData.userid);if(_this.state.formData.message)formData.append(\"message\",_this.state.formData.message);userInfo=JSON.parse(localStorage.getItem('user-info'));axios.interceptors.request.use(function(config){config.headers.authorization=\"Bearer \".concat(userInfo.user.token);return config;},function(error){return Promise.reject(error);});_context2.next=9;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/managers/messages\"),formData);case 9:response=_context2.sent;console.log(response.data);if(response.data.status==='success'){// NotificationManager.success('Mesaj gonderildi.', 'Success', 5000);\n_this.load();}if(response.data.status==='error'){message=response.data.message;for(_i=0,_Object$entries=Object.entries(message);_i<_Object$entries.length;_i++){_Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];console.log(key);NotificationManager.error(value,'Error',5000);}}case 13:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.deleteFile=function(){var newFormData=_this.state.formData;delete newFormData.file;console.log(newFormData);_this.setState({formData:newFormData});document.querySelector('form input[type=\"file\"]').value=null;};_this.dateReplace=function(time){var date=new Date(time);date=date.toString();date=date.split('GMT')[0];return date;};_this.messageRender=function(){var chat=[];if(_this.state.chat.length>0){_this.state.chat.map(function(value,index){if(value.sender===_this.state.myid){chat.push(/*#__PURE__*/_jsxs(\"div\",{className:\"row mt-3\",align:\"right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-11\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"position-relative col-12 px-3 rounded\",style:{border:'1px solid #4aa9e9'},children:[/*#__PURE__*/_jsx(\"div\",{class:\"TypingArrowRight\"}),/*#__PURE__*/_jsxs(\"p\",{children:[_this.dateReplace(value.created_at),\" \",/*#__PURE__*/_jsx(\"b\",{children:\"You\"})]}),/*#__PURE__*/_jsx(\"p\",{children:value.message}),value.file_url?/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"i\",{class:\"fas fa-paperclip\"}),\" \",/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(value.file_url,\"/\").concat(value.file_name),target:\"_blank\",download:\"\".concat(value.file_url,\"/\").concat(value.file_name),children:value.file_name})]}):null]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:/*#__PURE__*/_jsx(\"img\",{className:\"rounded-circle w-100\",style:{maxWidth:'80px',maxHeight:'80px'},src:value.user1_image?process.env.REACT_APP_URL+'/'+value.user1_image:img})})]}));}else{chat.push(/*#__PURE__*/_jsxs(\"div\",{className:\"row mt-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:/*#__PURE__*/_jsx(\"img\",{className:\"rounded-circle w-100\",style:{maxWidth:'80px',maxHeight:'80px'},src:value.user1_image?process.env.REACT_APP_URL+'/'+value.user1_image:img})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-11\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"position-relative col-12 px-3 rounded\",style:{border:'1px solid #20C997FF'},children:[/*#__PURE__*/_jsx(\"div\",{class:\"TypingArrowLeft\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(Link,{to:\"/User?user=\".concat(value.user1_id),children:value.user_1}),\" \",_this.dateReplace(value.created_at)]}),/*#__PURE__*/_jsx(\"p\",{children:value.message}),value.file_url?/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"i\",{class:\"fas fa-paperclip\"}),\" \",/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(value.file_url,\"/\").concat(value.file_name),target:\"_blank\",download:\"\".concat(value.file_url,\"/\").concat(value.file_name),children:value.file_name})]}):null]})})]}));}});}_this.setState({messageArea:chat});};_this.state={chat:[],messageArea:[],myid:0,userid:0,formData:{userid:0},display:true};return _this;}_createClass(Chat,[{key:\"getFiles\",value:function getFiles(event){var newFormData=this.state.formData;newFormData['file']=event.target.files[0];this.setState({formData:newFormData});}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NotificationContainer,{}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12\",children:/*#__PURE__*/_jsx(\"h4\",{children:this.state.user&&this.state.user.name})})}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:this.sendForm,children:[/*#__PURE__*/_jsx(\"textarea\",{className:\"form-control\",name:\"message\",rows:\"3\",onChange:this.handleFormData}),/*#__PURE__*/_jsxs(\"div\",{className:\"row mt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-sm-6\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"pr-3 text-danger\",style:{cursor:'pointer'},onClick:this.deleteFile,children:[/*#__PURE__*/_jsx(\"i\",{class:\"fas fa-times\"}),\" Delete file\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:this.getFiles.bind(this)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-sm-6 text-right\",children:/*#__PURE__*/_jsx(\"button\",{button:\"submit\",className:\"btn btn-success\",children:\"Send\"})})]})]})})}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading\",style:{display:this.state.display?'block':'none',top:'15px'},children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:/*#__PURE__*/_jsx(\"span\",{children:\"Loading...\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-12 p-3 bg-white pb-4 message-area\",children:this.state.messageArea.length>0?this.state.messageArea.map(function(value,index){return value;}):/*#__PURE__*/_jsx(\"div\",{className:\"\",children:/*#__PURE__*/_jsxs(\"h3\",{className:\"text-center m-0\",children:[\"No message \",/*#__PURE__*/_jsx(\"i\",{class:\"far fa-frown\"})]})})})]})})]})})]});}}]);return Chat;}(Component);export{Chat as default};","map":{"version":3,"sources":["C:/wamp64/www/INOVA/newsystem/manager/src/Components/Messages/Chat.js"],"names":["React","Component","axios","Link","NotificationContainer","NotificationManager","queryString","img","Chat","props","componentDidMount","load","name","pathname","window","location","split","id","length","userInfo","JSON","parse","localStorage","getItem","newFormData","state","formData","setState","userid","myid","user","user_info","interceptors","request","use","config","headers","authorization","token","error","Promise","reject","get","process","env","REACT_APP_API_URL","response","data","status","chat","display","messageRender","handleFormData","event","value","target","sendForm","preventDefault","FormData","file","append","message","post","console","log","Object","entries","key","deleteFile","document","querySelector","dateReplace","time","date","Date","toString","map","index","sender","push","border","created_at","file_url","file_name","maxWidth","maxHeight","user1_image","REACT_APP_URL","user1_id","user_1","messageArea","files","cursor","getFiles","bind","top"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport axios from 'axios';\r\nimport { Link } from \"react-router-dom\";\r\nimport {NotificationContainer, NotificationManager} from 'react-notifications';\r\nimport 'react-notifications/lib/notifications.css';\r\nimport queryString from 'query-string';\r\nimport img from '../../img/profile.jpg';\r\n// import FileBase64 from 'react-file-base64';\r\n\r\n\r\nexport default class Chat extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = { chat: [], messageArea: [], myid: 0, userid: 0, formData: {userid: 0}, display: true};\r\n    }\r\n    componentDidMount = () => {\r\n        this.load()\r\n    }\r\n    load = async name => {\r\n        const pathname = window.location.pathname.split('/');\r\n        \r\n        let id = pathname[pathname.length-1];\r\n        let userInfo = JSON.parse(localStorage.getItem('user-info'))\r\n\r\n        let newFormData = this.state.formData;\r\n        newFormData['userid'] = id\r\n\r\n        this.setState({\r\n            formData: newFormData\r\n        })\r\n\r\n        this.setState({ userid: id, myid: userInfo.user.user_info.id })\r\n        axios.interceptors.request.use(\r\n            config => {\r\n                config.headers.authorization = `Bearer ${userInfo.user.token}`;\r\n                return config;\r\n            },\r\n            error => {\r\n                return Promise.reject(error)\r\n            }\r\n        )\r\n        let response = await axios.get(`${process.env.REACT_APP_API_URL}/managers/messages/${id}`)\r\n        \r\n        if (response.data.status === 'success') {\r\n            this.setState({\r\n                chat: response.data.chat,\r\n                user: response.data.user,\r\n                display: false\r\n            })\r\n            this.messageRender();\r\n        }\r\n\r\n    }\r\n    handleFormData = event => {\r\n        let value = event.target.value\r\n        let name = event.target.name\r\n        \r\n        let newFormData = this.state.formData;\r\n        if(value === '')\r\n        {\r\n            delete newFormData[`${name}`];\r\n        }\r\n        else{\r\n            newFormData[name] = value\r\n        }\r\n        this.setState({\r\n            formData: newFormData\r\n        })\r\n    }\r\n    sendForm = async (event) => {\r\n        event.preventDefault()\r\n        let formData = new FormData();\r\n        if(this.state.formData.file)\r\n            formData.append(\"file\", this.state.formData.file)\r\n        if(this.state.formData.userid)\r\n            formData.append(\"userid\", this.state.formData.userid)\r\n        if(this.state.formData.message)\r\n            formData.append(\"message\", this.state.formData.message)\r\n\r\n        let userInfo = JSON.parse(localStorage.getItem('user-info'))\r\n        axios.interceptors.request.use(\r\n            config => {\r\n                config.headers.authorization = `Bearer ${userInfo.user.token}`;\r\n                return config;\r\n            },\r\n            error => {\r\n                return Promise.reject(error)\r\n            }\r\n        )\r\n        let response= await axios.post(`${process.env.REACT_APP_API_URL}/managers/messages`, formData)\r\n        console.log(response.data)\r\n        if(response.data.status === 'success'){\r\n            // NotificationManager.success('Mesaj gonderildi.', 'Success', 5000);\r\n            this.load()\r\n        }\r\n        if(response.data.status === 'error'){\r\n            let message = response.data.message;\r\n            for (const [key, value] of Object.entries(message)) {\r\n                console.log(key)\r\n                NotificationManager.error(value, 'Error', 5000);\r\n            }\r\n        }\r\n\r\n    }\r\n    getFiles(event){\r\n\r\n        let newFormData = this.state.formData;\r\n        newFormData['file'] = event.target.files[0]\r\n        this.setState({\r\n            formData: newFormData\r\n        })\r\n    }\r\n    deleteFile = () => {\r\n        let newFormData = this.state.formData;\r\n        delete newFormData.file;\r\n        console.log(newFormData)\r\n        this.setState({\r\n            formData: newFormData\r\n        })\r\n        document.querySelector('form input[type=\"file\"]').value = null\r\n    }\r\n    dateReplace = (time) => {\r\n        let date = new Date(time)\r\n        date = date.toString()\r\n        date = date.split('GMT')[0]\r\n        return date\r\n    }\r\n    messageRender = () => {\r\n        let chat = []\r\n        if(this.state.chat.length > 0){\r\n            this.state.chat.map((value, index) => {\r\n                if (value.sender === this.state.myid) {\r\n                    chat.push(\r\n                        <div className=\"row mt-3\" align=\"right\">\r\n                            <div className=\"col-11\">\r\n                                <div className=\"position-relative col-12 px-3 rounded\" style={{ border: '1px solid #4aa9e9' }}>\r\n                                    <div class=\"TypingArrowRight\"></div>\r\n                                    <p>{this.dateReplace(value.created_at)} <b>You</b></p>\r\n                                    <p>{value.message}</p>\r\n                                    {\r\n                                        (value.file_url) ? <p><i class=\"fas fa-paperclip\"></i> <a href={`${value.file_url}/${value.file_name}`} target=\"_blank\" download={`${value.file_url}/${value.file_name}`}>{value.file_name}</a></p> : null\r\n                                    }\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"col\">\r\n                                <img className=\"rounded-circle w-100\" style={{ maxWidth: '80px', maxHeight: '80px' }}  src={value.user1_image ? process.env.REACT_APP_URL + '/' + value.user1_image : img} />\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n                else {\r\n                    chat.push(\r\n                        <div className=\"row mt-3\">\r\n                            <div className=\"col\">\r\n                                <img className=\"rounded-circle w-100\" style={{ maxWidth: '80px', maxHeight: '80px' }} src={value.user1_image ?  process.env.REACT_APP_URL + '/' + value.user1_image : img} />\r\n                            </div>\r\n                            <div className=\"col-11\">\r\n                                <div className=\"position-relative col-12 px-3 rounded\" style={{ border: '1px solid #20C997FF' }}>\r\n                                    <div class=\"TypingArrowLeft\"></div>\r\n                                    <p><Link to={`/User?user=${value.user1_id}`}>{value.user_1}</Link> {this.dateReplace(value.created_at)}</p>\r\n                                    <p>{value.message}</p>\r\n                                    {\r\n                                        (value.file_url) ? <p><i class=\"fas fa-paperclip\"></i> <a href={`${value.file_url}/${value.file_name}`} target=\"_blank\" download={`${value.file_url}/${value.file_name}`}>{value.file_name}</a></p> : null\r\n                                    }\r\n\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n            })\r\n        }\r\n        this.setState({\r\n            messageArea: chat\r\n        })\r\n        \r\n    }\r\n    render() {\r\n        return (\r\n            <>\r\n            <NotificationContainer />\r\n            <div className=\"row\">\r\n                <div className=\"col-12\">\r\n                    <div className=\"row\">\r\n                        <div className=\"col-12\">\r\n                            <h4>{this.state.user && this.state.user.name}</h4>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"row\">\r\n                        <div className=\"col-12\">\r\n                            <form onSubmit={this.sendForm}>\r\n                                <textarea className=\"form-control\" name=\"message\" rows=\"3\" onChange={this.handleFormData}></textarea>\r\n                                <div className=\"row mt-2\">\r\n                                    <div className=\"col-sm-6\">\r\n                                        <span className=\"pr-3 text-danger\" style={{cursor: 'pointer'}} onClick={this.deleteFile}><i class=\"fas fa-times\"></i> Delete file</span>\r\n                                        <input type=\"file\" onChange={this.getFiles.bind(this)} />\r\n                                       {/* <FileBase64\r\n                                            multiple={ false }\r\n                                            onDone={ this.getFiles.bind(this) } /> */}\r\n                                    </div>\r\n                                    <div className=\"col-sm-6 text-right\">\r\n                                        <button button=\"submit\" className=\"btn btn-success\">Send</button>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                    <hr />\r\n                    <div className=\"row\">\r\n                        <div className=\"col-12\">\r\n                        <div className=\"loading\" style={{ display: this.state.display ? 'block' : 'none', top: '15px' }}>\r\n                            <div className=\"text-center\">\r\n                                <span>\r\n                                    Loading...\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                            <div className=\"col-12 p-3 bg-white pb-4 message-area\">\r\n                                {\r\n                                    this.state.messageArea.length > 0 ? this.state.messageArea.map((value, index) => {\r\n                                        return value\r\n                                    }) : <div className=\"\"><h3 className=\"text-center m-0\">No message <i class=\"far fa-frown\"></i></h3></div>\r\n                                }\r\n\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            </>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}